<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.11 Còpies de seguretat | Arts escèniques</title>
  <meta name="description" content="Projecte Asisx I.E. Maria Enriques" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="4.11 Còpies de seguretat | Arts escèniques" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Projecte Asisx I.E. Maria Enriques" />
  <meta name="github-repo" content="incitato/prova" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.11 Còpies de seguretat | Arts escèniques" />
  
  <meta name="twitter:description" content="Projecte Asisx I.E. Maria Enriques" />
  

<meta name="author" content="Ramiro Palau Gregori" />


<meta name="date" content="2022-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="subxarxes-en-proxmox.html"/>
<link rel="next" href="pfsense.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Arts esceniques</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>A proposit del treball</a>
<ul>
<li class="chapter" data-level="" data-path="propòsit.html"><a href="propòsit.html"><i class="fa fa-check"></i>Propòsit</a>
<ul>
<li class="chapter" data-level="" data-path="propòsit.html"><a href="propòsit.html#plan-b"><i class="fa fa-check"></i>Plan B</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="agraïments.html"><a href="agraïments.html"><i class="fa fa-check"></i>Agraïments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="infraestructura.html"><a href="infraestructura.html"><i class="fa fa-check"></i><b>1</b> Infraestructura</a>
<ul>
<li class="chapter" data-level="1.1" data-path="xarxa-per-a-la-sala.html"><a href="xarxa-per-a-la-sala.html"><i class="fa fa-check"></i><b>1.1</b> Xarxa per a la sala</a></li>
<li class="chapter" data-level="1.2" data-path="descripció-de-les-installacions.html"><a href="descripció-de-les-installacions.html"><i class="fa fa-check"></i><b>1.2</b> Descripció de les instal·lacions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="descripció-de-les-installacions.html"><a href="descripció-de-les-installacions.html#oficina"><i class="fa fa-check"></i><b>1.2.1</b> Oficina</a></li>
<li class="chapter" data-level="1.2.2" data-path="descripció-de-les-installacions.html"><a href="descripció-de-les-installacions.html#sala-despera"><i class="fa fa-check"></i><b>1.2.2</b> Sala d’espera</a></li>
<li class="chapter" data-level="1.2.3" data-path="descripció-de-les-installacions.html"><a href="descripció-de-les-installacions.html#escenari"><i class="fa fa-check"></i><b>1.2.3</b> Escenari</a></li>
<li class="chapter" data-level="1.2.4" data-path="descripció-de-les-installacions.html"><a href="descripció-de-les-installacions.html#rebost"><i class="fa fa-check"></i><b>1.2.4</b> Rebost</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="descripció-de-les-xarxes.html"><a href="descripció-de-les-xarxes.html"><i class="fa fa-check"></i><b>1.3</b> Descripció de les xarxes</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="descripció-de-les-xarxes.html"><a href="descripció-de-les-xarxes.html#vlan-1-administració"><i class="fa fa-check"></i><b>1.3.1</b> VLAN 1 Administració</a></li>
<li class="chapter" data-level="1.3.2" data-path="descripció-de-les-xarxes.html"><a href="descripció-de-les-xarxes.html#vlan-20-privat"><i class="fa fa-check"></i><b>1.3.2</b> VLAN 20 Privat</a></li>
<li class="chapter" data-level="1.3.3" data-path="descripció-de-les-xarxes.html"><a href="descripció-de-les-xarxes.html#vlan-30-video"><i class="fa fa-check"></i><b>1.3.3</b> VLAN 30 Video</a></li>
<li class="chapter" data-level="1.3.4" data-path="descripció-de-les-xarxes.html"><a href="descripció-de-les-xarxes.html#vlan-40-pública"><i class="fa fa-check"></i><b>1.3.4</b> VLAN 40 pública</a></li>
<li class="chapter" data-level="1.3.5" data-path="descripció-de-les-xarxes.html"><a href="descripció-de-les-xarxes.html#xarxa-interna-dels-serveis"><i class="fa fa-check"></i><b>1.3.5</b> Xarxa interna dels serveis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="proposta-de-projecte.html"><a href="proposta-de-projecte.html"><i class="fa fa-check"></i><b>2</b> Proposta de projecte</a>
<ul>
<li class="chapter" data-level="2.1" data-path="serveis-proposats.html"><a href="serveis-proposats.html"><i class="fa fa-check"></i><b>2.1</b> Serveis proposats</a></li>
<li class="chapter" data-level="2.2" data-path="pressupost-del-maquinari.html"><a href="pressupost-del-maquinari.html"><i class="fa fa-check"></i><b>2.2</b> Pressupost del maquinari</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="servidor.html"><a href="servidor.html"><i class="fa fa-check"></i><b>3</b> Servidor</a></li>
<li class="chapter" data-level="4" data-path="proxmox.html"><a href="proxmox.html"><i class="fa fa-check"></i><b>4</b> Proxmox</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preliminars.html"><a href="preliminars.html"><i class="fa fa-check"></i><b>4.1</b> Preliminars</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="preliminars.html"><a href="preliminars.html#servidor-nfs-en-local"><i class="fa fa-check"></i><b>4.1.1</b> Servidor NFS en local</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="installacio-de-proxmox-en-una-vm-amb-kvm.html"><a href="installacio-de-proxmox-en-una-vm-amb-kvm.html"><i class="fa fa-check"></i><b>4.2</b> Instal·lacio de Proxmox en una VM amb KVM</a></li>
<li class="chapter" data-level="4.3" data-path="arranquem-la-installacio.html"><a href="arranquem-la-installacio.html"><i class="fa fa-check"></i><b>4.3</b> Arranquem la instal·lacio</a></li>
<li class="chapter" data-level="4.4" data-path="primeres-configuracions.html"><a href="primeres-configuracions.html"><i class="fa fa-check"></i><b>4.4</b> Primeres configuracions</a></li>
<li class="chapter" data-level="4.5" data-path="actualitzar-repositoris.html"><a href="actualitzar-repositoris.html"><i class="fa fa-check"></i><b>4.5</b> Actualitzar repositoris</a></li>
<li class="chapter" data-level="4.6" data-path="afegir-nous-hd-al-servidor.html"><a href="afegir-nous-hd-al-servidor.html"><i class="fa fa-check"></i><b>4.6</b> Afegir nous HD al servidor</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="afegir-nous-hd-al-servidor.html"><a href="afegir-nous-hd-al-servidor.html#procediment"><i class="fa fa-check"></i><b>4.6.1</b> Procediment</a></li>
<li class="chapter" data-level="4.6.2" data-path="afegir-nous-hd-al-servidor.html"><a href="afegir-nous-hd-al-servidor.html#configuracio-del-nou-ssd-per-a-les-vm"><i class="fa fa-check"></i><b>4.6.2</b> Configuracio del nou SSD per a les VM</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="afegir-lemmagatzenament-de-còpia-de-seguretat.html"><a href="afegir-lemmagatzenament-de-còpia-de-seguretat.html"><i class="fa fa-check"></i><b>4.7</b> Afegir l’emmagatzenament de còpia de seguretat</a></li>
<li class="chapter" data-level="4.8" data-path="crear-nova-vm.html"><a href="crear-nova-vm.html"><i class="fa fa-check"></i><b>4.8</b> Crear nova VM</a></li>
<li class="chapter" data-level="4.9" data-path="contenidors-lxc-en-proxmox.html"><a href="contenidors-lxc-en-proxmox.html"><i class="fa fa-check"></i><b>4.9</b> Contenidors LXC en Proxmox</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="contenidors-lxc-en-proxmox.html"><a href="contenidors-lxc-en-proxmox.html#distribucions-suportades"><i class="fa fa-check"></i><b>4.9.1</b> Distribucions suportades</a></li>
<li class="chapter" data-level="4.9.2" data-path="contenidors-lxc-en-proxmox.html"><a href="contenidors-lxc-en-proxmox.html#imatges-de-contenidors"><i class="fa fa-check"></i><b>4.9.2</b> Imatges de contenidors</a></li>
<li class="chapter" data-level="4.9.3" data-path="contenidors-lxc-en-proxmox.html"><a href="contenidors-lxc-en-proxmox.html#creem-una-ct-amb-la-imatge-que-acabem-de-baixar"><i class="fa fa-check"></i><b>4.9.3</b> Creem una CT amb la imatge que acabem de baixar</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="subxarxes-en-proxmox.html"><a href="subxarxes-en-proxmox.html"><i class="fa fa-check"></i><b>4.10</b> Subxarxes en Proxmox</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="subxarxes-en-proxmox.html"><a href="subxarxes-en-proxmox.html#segon-intercace-post-install"><i class="fa fa-check"></i><b>4.10.1</b> Segon intercace, post install</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="còpies-de-seguretat.html"><a href="còpies-de-seguretat.html"><i class="fa fa-check"></i><b>4.11</b> Còpies de seguretat</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="còpies-de-seguretat.html"><a href="còpies-de-seguretat.html#copia-de-seguretat-de-truena"><i class="fa fa-check"></i><b>4.11.1</b> Copia de seguretat de truena</a></li>
<li class="chapter" data-level="4.11.2" data-path="còpies-de-seguretat.html"><a href="còpies-de-seguretat.html#còpia-de-seguretat-de-proxmox"><i class="fa fa-check"></i><b>4.11.2</b> Còpia de seguretat de Proxmox</a></li>
<li class="chapter" data-level="4.11.3" data-path="còpies-de-seguretat.html"><a href="còpies-de-seguretat.html#pve-zsync"><i class="fa fa-check"></i><b>4.11.3</b> pve-zsync</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="pfsense.html"><a href="pfsense.html"><i class="fa fa-check"></i><b>5</b> pfSense</a>
<ul>
<li class="chapter" data-level="5.1" data-path="per-a-què-el-farem-servir.html"><a href="per-a-què-el-farem-servir.html"><i class="fa fa-check"></i><b>5.1</b> Per a què el farem servir</a></li>
<li class="chapter" data-level="5.2" data-path="requeriments.html"><a href="requeriments.html"><i class="fa fa-check"></i><b>5.2</b> Requeriments</a></li>
<li class="chapter" data-level="5.3" data-path="installació.html"><a href="installació.html"><i class="fa fa-check"></i><b>5.3</b> Instal·lació</a></li>
<li class="chapter" data-level="5.4" data-path="configuració.html"><a href="configuració.html"><i class="fa fa-check"></i><b>5.4</b> Configuració</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="configuració.html"><a href="configuració.html#informació-general"><i class="fa fa-check"></i><b>5.4.1</b> Informació general</a></li>
<li class="chapter" data-level="5.4.2" data-path="configuració.html"><a href="configuració.html#configuració-wan"><i class="fa fa-check"></i><b>5.4.2</b> Configuració WAN</a></li>
<li class="chapter" data-level="5.4.3" data-path="configuració.html"><a href="configuració.html#configuració-lan"><i class="fa fa-check"></i><b>5.4.3</b> Configuració LAN</a></li>
<li class="chapter" data-level="5.4.4" data-path="configuració.html"><a href="configuració.html#configuració-de-les-vlan"><i class="fa fa-check"></i><b>5.4.4</b> Configuració de les VLAN</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="configuració-dns.html"><a href="configuració-dns.html"><i class="fa fa-check"></i><b>5.5</b> Configuració DNS</a></li>
<li class="chapter" data-level="5.6" data-path="firewall.html"><a href="firewall.html"><i class="fa fa-check"></i><b>5.6</b> Firewall</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="firewall.html"><a href="firewall.html#vlan-1"><i class="fa fa-check"></i><b>5.6.1</b> VLAN 1</a></li>
<li class="chapter" data-level="5.6.2" data-path="firewall.html"><a href="firewall.html#vlan-20"><i class="fa fa-check"></i><b>5.6.2</b> VLAN 20</a></li>
<li class="chapter" data-level="5.6.3" data-path="firewall.html"><a href="firewall.html#vlan-30-soles-interna-no-internet"><i class="fa fa-check"></i><b>5.6.3</b> VLAN 30 soles interna, no internet</a></li>
<li class="chapter" data-level="5.6.4" data-path="firewall.html"><a href="firewall.html#vlan-40-soles-internet"><i class="fa fa-check"></i><b>5.6.4</b> VLAN 40 Soles internet</a></li>
<li class="chapter" data-level="5.6.5" data-path="firewall.html"><a href="firewall.html#lan"><i class="fa fa-check"></i><b>5.6.5</b> LAN</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="dns-dinàmic.html"><a href="dns-dinàmic.html"><i class="fa fa-check"></i><b>5.7</b> DNS dinàmic</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="dns-dinàmic.html"><a href="dns-dinàmic.html#renovacions-del-servei"><i class="fa fa-check"></i><b>5.7.1</b> Renovacions del servei</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="vpn.html"><a href="vpn.html"><i class="fa fa-check"></i><b>5.8</b> vpn</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="vpn.html"><a href="vpn.html#autenticació"><i class="fa fa-check"></i><b>5.8.1</b> Autenticació</a></li>
<li class="chapter" data-level="5.8.2" data-path="vpn.html"><a href="vpn.html#firewall-1"><i class="fa fa-check"></i><b>5.8.2</b> Firewall</a></li>
<li class="chapter" data-level="5.8.3" data-path="vpn.html"><a href="vpn.html#configuració-òptima-de-xifratge"><i class="fa fa-check"></i><b>5.8.3</b> Configuració òptima de xifratge</a></li>
<li class="chapter" data-level="5.8.4" data-path="vpn.html"><a href="vpn.html#udp"><i class="fa fa-check"></i><b>5.8.4</b> UDP</a></li>
<li class="chapter" data-level="5.8.5" data-path="vpn.html"><a href="vpn.html#utilitzeu-tls-només-per-a-lautenticació"><i class="fa fa-check"></i><b>5.8.5</b> Utilitzeu TLS només per a l’autenticació</a></li>
<li class="chapter" data-level="5.8.6" data-path="vpn.html"><a href="vpn.html#utilitzeu-la-negociació-de-xifratge-de-dades"><i class="fa fa-check"></i><b>5.8.6</b> Utilitzeu la negociació de xifratge de dades</a></li>
<li class="chapter" data-level="5.8.7" data-path="vpn.html"><a href="vpn.html#túnels-dividits"><i class="fa fa-check"></i><b>5.8.7</b> Túnels dividits</a></li>
<li class="chapter" data-level="5.8.8" data-path="vpn.html"><a href="vpn.html#desactiva-la-compressió"><i class="fa fa-check"></i><b>5.8.8</b> Desactiva la compressió</a></li>
<li class="chapter" data-level="5.8.9" data-path="vpn.html"><a href="vpn.html#connexions-duplicades"><i class="fa fa-check"></i><b>5.8.9</b> Connexions duplicades</a></li>
<li class="chapter" data-level="5.8.10" data-path="vpn.html"><a href="vpn.html#augmenta-la-memòria-intermèdia-denviamentrecepció"><i class="fa fa-check"></i><b>5.8.10</b> Augmenta la memòria intermèdia d’enviament/recepció</a></li>
<li class="chapter" data-level="5.8.11" data-path="vpn.html"><a href="vpn.html#openvpn-i-certificats"><i class="fa fa-check"></i><b>5.8.11</b> OpenVPN i certificats</a></li>
<li class="chapter" data-level="5.8.12" data-path="vpn.html"><a href="vpn.html#mode-de-dispositiu"><i class="fa fa-check"></i><b>5.8.12</b> Mode de dispositiu</a></li>
<li class="chapter" data-level="5.8.13" data-path="vpn.html"><a href="vpn.html#configuració-1"><i class="fa fa-check"></i><b>5.8.13</b> Configuració</a></li>
<li class="chapter" data-level="5.8.14" data-path="vpn.html"><a href="vpn.html#configuracio-del-servidor"><i class="fa fa-check"></i><b>5.8.14</b> Configuracio del servidor</a></li>
<li class="chapter" data-level="5.8.15" data-path="vpn.html"><a href="vpn.html#servidors-dautentificacio"><i class="fa fa-check"></i><b>5.8.15</b> Servidors d’autentificacio</a></li>
<li class="chapter" data-level="5.8.16" data-path="vpn.html"><a href="vpn.html#exportar-els-arxius-de-configuracio-vpn-dels-clients"><i class="fa fa-check"></i><b>5.8.16</b> Exportar els arxius de configuracio VPN dels clients</a></li>
<li class="chapter" data-level="5.8.17" data-path="vpn.html"><a href="vpn.html#configuracio-vlan-en-ubuntu-host"><i class="fa fa-check"></i><b>5.8.17</b> Configuracio VLAN en ubuntu host</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="truenas.html"><a href="truenas.html"><i class="fa fa-check"></i><b>6</b> TrueNas</a>
<ul>
<li class="chapter" data-level="6.1" data-path="installar-truenass.html"><a href="installar-truenass.html"><i class="fa fa-check"></i><b>6.1</b> Instal·lar Truenass</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="installar-truenass.html"><a href="installar-truenass.html#afegirem-disc-de-pas-discs-reals"><i class="fa fa-check"></i><b>6.1.1</b> Afegirem disc de pas, discs reals</a></li>
<li class="chapter" data-level="6.1.2" data-path="installar-truenass.html"><a href="installar-truenass.html#afegim-el-disc-a-truenas"><i class="fa fa-check"></i><b>6.1.2</b> Afegim el disc a Truenas</a></li>
<li class="chapter" data-level="6.1.3" data-path="installar-truenass.html"><a href="installar-truenass.html#afegim-els-discs-a-proxmox"><i class="fa fa-check"></i><b>6.1.3</b> Afegim els discs a Proxmox</a></li>
<li class="chapter" data-level="6.1.4" data-path="installar-truenass.html"><a href="installar-truenass.html#volums"><i class="fa fa-check"></i><b>6.1.4</b> Volums</a></li>
<li class="chapter" data-level="6.1.5" data-path="installar-truenass.html"><a href="installar-truenass.html#zfs"><i class="fa fa-check"></i><b>6.1.5</b> ZFS</a></li>
<li class="chapter" data-level="6.1.6" data-path="installar-truenass.html"><a href="installar-truenass.html#configurar-el-nou-disk"><i class="fa fa-check"></i><b>6.1.6</b> Configurar el nou disk</a></li>
<li class="chapter" data-level="6.1.7" data-path="installar-truenass.html"><a href="installar-truenass.html#passthrough-disc-físic-a-màquina-virtual-forma-correcta"><i class="fa fa-check"></i><b>6.1.7</b> Passthrough disc físic a màquina virtual (forma correcta)</a></li>
<li class="chapter" data-level="6.1.8" data-path="installar-truenass.html"><a href="installar-truenass.html#crear-dataset"><i class="fa fa-check"></i><b>6.1.8</b> Crear dataset</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="politaca-de-volums.html"><a href="politaca-de-volums.html"><i class="fa fa-check"></i><b>6.2</b> Politaca de volums</a></li>
<li class="chapter" data-level="6.3" data-path="configuracio-del-disc-backup-total.html"><a href="configuracio-del-disc-backup-total.html"><i class="fa fa-check"></i><b>6.3</b> Configuracio del disc Backup Total</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="configuracio-del-disc-backup-total.html"><a href="configuracio-del-disc-backup-total.html#treballs-de-sincronitzacio"><i class="fa fa-check"></i><b>6.3.1</b> Treballs de sincronitzacio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="nextcloud.html"><a href="nextcloud.html"><i class="fa fa-check"></i><b>7</b> Nextcloud</a>
<ul>
<li class="chapter" data-level="7.1" data-path="importar-imatge-.html"><a href="importar-imatge-.html"><i class="fa fa-check"></i><b>7.1</b> Importar imatge .vmdk</a></li>
<li class="chapter" data-level="7.2" data-path="volum-de-dades-nfs.html"><a href="volum-de-dades-nfs.html"><i class="fa fa-check"></i><b>7.2</b> volum de dades NFS</a></li>
<li class="chapter" data-level="7.3" data-path="gestió-dusuaris-openldap.html"><a href="gestió-dusuaris-openldap.html"><i class="fa fa-check"></i><b>7.3</b> Gestió d’usuaris openLDAP</a></li>
<li class="chapter" data-level="7.4" data-path="certificat-lets-encrypt.html"><a href="certificat-lets-encrypt.html"><i class="fa fa-check"></i><b>7.4</b> Certificat Let’s Encrypt</a></li>
<li class="chapter" data-level="7.5" data-path="configuracio-daplicacions-nextcloud.html"><a href="configuracio-daplicacions-nextcloud.html"><i class="fa fa-check"></i><b>7.5</b> Configuracio d’aplicacions Nextcloud</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="zoneminder.html"><a href="zoneminder.html"><i class="fa fa-check"></i><b>8</b> Zoneminder</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ldap-apache.html"><a href="ldap-apache.html"><i class="fa fa-check"></i><b>8.1</b> LDAP Apache</a></li>
<li class="chapter" data-level="8.2" data-path="vlan.html"><a href="vlan.html"><i class="fa fa-check"></i><b>8.2</b> VLAN</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="vlan.html"><a href="vlan.html#configuracio-de-les-targetes-de-xarxa"><i class="fa fa-check"></i><b>8.2.1</b> Configuracio de les targetes de xarxa</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="configuració-de-les-càmeres.html"><a href="configuració-de-les-càmeres.html"><i class="fa fa-check"></i><b>8.3</b> Configuració de les càmeres</a></li>
<li class="chapter" data-level="8.4" data-path="espai-demmagatzematge.html"><a href="espai-demmagatzematge.html"><i class="fa fa-check"></i><b>8.4</b> Espai d’emmagatzematge</a></li>
<li class="chapter" data-level="8.5" data-path="proves-pendents.html"><a href="proves-pendents.html"><i class="fa fa-check"></i><b>8.5</b> Proves pendents</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="installació-de-wifi.html"><a href="installació-de-wifi.html"><i class="fa fa-check"></i><b>9</b> Instal·lació de wifi</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="installació-de-wifi.html"><a href="installació-de-wifi.html#potència-de-la-connexió-dinternet-per-donar-servei"><i class="fa fa-check"></i><b>9.0.1</b> Potència de la connexió d’internet per donar servei</a></li>
<li class="chapter" data-level="9.1" data-path="muntatge.html"><a href="muntatge.html"><i class="fa fa-check"></i><b>9.1</b> Muntatge</a></li>
<li class="chapter" data-level="9.2" data-path="com-fer-ho.html"><a href="com-fer-ho.html"><i class="fa fa-check"></i><b>9.2</b> Com fer-ho</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="com-fer-ho.html"><a href="com-fer-ho.html#procediment-1"><i class="fa fa-check"></i><b>9.2.1</b> Procediment</a></li>
<li class="chapter" data-level="9.2.2" data-path="com-fer-ho.html"><a href="com-fer-ho.html#assigna-les-vlan-al-controlador-unifi"><i class="fa fa-check"></i><b>9.2.2</b> Assigna les VLAN al controlador UniFi</a></li>
<li class="chapter" data-level="9.2.3" data-path="com-fer-ho.html"><a href="com-fer-ho.html#unifi-pfsense-on-instal.lar-el-controlador-de-les-antenes"><i class="fa fa-check"></i><b>9.2.3</b> unifi-pfsense, on instal.lar el controlador de les antenes</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Arts escèniques</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="còpies-de-seguretat" class="section level2 hasAnchor" number="4.11">
<h2><span class="header-section-number">4.11</span> Còpies de seguretat<a href="còpies-de-seguretat.html#còpies-de-seguretat" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Les imatges de les VM no haurien de canviar molt en el temps, per això, tindrem una politica de còpies de seguretat d’una vegada al mes, mantenint la primera configuracio blocada a l’esborrat.</p>
<p>Durem a terme aquesta tasca amb l’opcio que de backup que porta el GUI, tenint en compte de no afegir discs durs secondaris de les VM si en tingueren, no es el cas, en la forma que ho hem configurat, l’espai per a dades el compartim per xarxa, i no entra en le backup per defecte.</p>
<p>Per fer les còpies de seguretat de les VM anem a centre de dades
En centre de dades -&gt; còpia de seguretat -&gt; afegir nova ens ix el seguent panell.</p>
<ol style="list-style-type: decimal">
<li>Node, el nostre node, soles en tenim un.</li>
<li>Emmagatzenament, on volem que es cree la imatge, en Backup que es l’espai compartit pel nas.</li>
<li>Programes, configurem la frecuancia de les còpies, una al mes a les 3 a.m.</li>
<li>Elmode, soles les escollides, ja que la de Truenas no volem que la faça.</li>
<li>Compresio, podem elegir el tipus, que compremeix mes i tarda més, el de per defecte va bé.</li>
<li>El mode, seleccionem si volem instantanea, suspensio o aturada, le més segura és aturada, i com les farem a altes hores i no tindra usuaris el servei, no deu ser problema, si no podera para, es faria instanatanea.</li>
</ol>
<div class="figure">
<img src="imatges/proxmox/backup1.png" style="width:50.0%" alt="" />
<p class="caption">Configurar la còpia de seguretat de les VM</p>
</div>
<p>En l’opcio retention configurem perquè soles guarde les dues últimes.</p>
<div class="figure">
<img src="imatges/proxmox/backup2.png" style="width:50.0%" alt="" />
<p class="caption">Seleccionar les remanents</p>
</div>
<p>Per conservar una imatge determinada, en el nostre cas la primera de configuracio inicial, en el volum on estan guardades, backup, seleccionem la que volem protegir i li canviem en change protection que deuria d’apareixer ara l’escut.</p>
<div class="figure">
<img src="imatges/proxmox/protect.png" style="width:80.0%" alt="" />
<p class="caption">Ramanencia d’una còpia en concret</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sheets-option-drag212"></span>
<img src="imatges/proxmox/backup_vm.gif" alt="Copia seguretat VM"  />
<p class="caption">
Imatge 4.3: Copia seguretat VM
</p>
</div>
<div id="copia-de-seguretat-de-truena" class="section level3 hasAnchor" number="4.11.1">
<h3><span class="header-section-number">4.11.1</span> Copia de seguretat de truena<a href="còpies-de-seguretat.html#copia-de-seguretat-de-truena" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>No podem fer una còpia de seguretat de Truenas i guardar-la per xarxa en Truenas. En principi es podria fer una instanatanea, pero s’atura el servei i es queda clavat.</p>
<p>Farem còpia de seguretat en local i després la pasarem al directori de Backup amb rsync.
La fem com en el cas anterior, pero ara la guardarem en local.</p>
<div class="figure">
<img src="imatges/proxmox/copia_seguretat_Truenas_local.png" style="width:50.0%" alt="" />
<p class="caption">Còpia de seguretat Truenas local</p>
</div>
<p>i li diguem que guarde les dues últimes</p>
<p>Les guada en <em>./var/lib/vz/dump/vzdump-qemu-102-2022_05_27-22_27_02.vma.zst</em>
les passarem per rsync al directori de backup de les VM compartit per Tuenas, està en <em>/mnt/pve/backup/dump</em></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="còpies-de-seguretat.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/mnt/pve/backup/dump#</span> ls</span>
<span id="cb27-2"><a href="còpies-de-seguretat.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">vzdump-qemu-105-2022_06_02-00_02_12.log</span></span>
<span id="cb27-3"><a href="còpies-de-seguretat.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">vzdump-qemu-107-2022_05_30-23_54_17.log</span></span>
<span id="cb27-4"><a href="còpies-de-seguretat.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">vzdump-qemu-105-2022_06_02-00_02_12.vma.zst</span></span>
<span id="cb27-5"><a href="còpies-de-seguretat.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">vzdump-qemu-107-2022_05_30-23_54_17.vma.zst</span></span>
<span id="cb27-6"><a href="còpies-de-seguretat.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">vzdump-qemu-105-2022_06_02-00_02_12.vma.zst.notes</span></span>
<span id="cb27-7"><a href="còpies-de-seguretat.html#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="ex">vzdump-qemu-107-2022_05_30-23_54_17.vma.zst.notes</span></span>
<span id="cb27-8"><a href="còpies-de-seguretat.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="ex">vzdump-qemu-107-2022_05_30-23_49_20.log</span></span>
<span id="cb27-9"><a href="còpies-de-seguretat.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/mnt/pve/backup/dump#</span> rsync <span class="at">-a</span> /var/lib/vz/dump/ /mnt/pve/backup/dump</span></code></pre></div>
<p>Quan acaba, ja ens apareix en l’espai d’emmagatzenamet backup.</p>
<div class="figure">
<img src="imatges/proxmox/rsync_tue.png" style="width:80.0%" alt="" />
<p class="caption">Sincronitzacio de la imatge Truanas</p>
</div>
<p>Farem un scipt perquè sincronitze el directori local amb del backup i ho afegirem a cron en la periocitat bque hem definit per a fer les còpies, en principi a principi de cada mes, deixarem un marge de temps i sincronitzarem una hora després.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="còpies-de-seguretat.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb28-2"><a href="còpies-de-seguretat.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-a</span> /var/lib/vz/dump/ /mnt/pve/backup/dump</span></code></pre></div>
</div>
<div id="còpia-de-seguretat-de-proxmox" class="section level3 hasAnchor" number="4.11.2">
<h3><span class="header-section-number">4.11.2</span> Còpia de seguretat de Proxmox<a href="còpies-de-seguretat.html#còpia-de-seguretat-de-proxmox" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Com el sistema base de proxmox, una Debian 11 està en un volum ZFS fem un clon de rpool que es un estan el directori arrel i el guardem en l’espai Backup en el servidor nas.</p>
<div class="rmdwarn">
<p>Com estem en el porces de proves i no voldria trencar les cosesque de moment van, he efegit un altre disc virtual la VM de proxmox l’hem creat un colum ZFS que es diu vmZFS1 per fer les proves de clonacio. en backup seria igual pero encaminant al directori on està muntat vmZFS</p>
</div>
<p>Primer mirem els pools que té proxmox</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="còpies-de-seguretat.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:~#</span> zpool status</span>
<span id="cb29-2"><a href="còpies-de-seguretat.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">pool:</span> rpool</span>
<span id="cb29-3"><a href="còpies-de-seguretat.html#cb29-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">state:</span> ONLINE</span>
<span id="cb29-4"><a href="còpies-de-seguretat.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="ex">config:</span></span>
<span id="cb29-5"><a href="còpies-de-seguretat.html#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="còpies-de-seguretat.html#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">NAME</span>        STATE     READ WRITE CKSUM</span>
<span id="cb29-7"><a href="còpies-de-seguretat.html#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">rpool</span>       ONLINE       0     0     0</span>
<span id="cb29-8"><a href="còpies-de-seguretat.html#cb29-8" aria-hidden="true" tabindex="-1"></a>          <span class="ex">vda3</span>      ONLINE       0     0     0</span>
<span id="cb29-9"><a href="còpies-de-seguretat.html#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="còpies-de-seguretat.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="ex">errors:</span> No known data errors</span>
<span id="cb29-11"><a href="còpies-de-seguretat.html#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="còpies-de-seguretat.html#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">pool:</span> vmZFS</span>
<span id="cb29-13"><a href="còpies-de-seguretat.html#cb29-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">state:</span> ONLINE</span>
<span id="cb29-14"><a href="còpies-de-seguretat.html#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="ex">config:</span></span>
<span id="cb29-15"><a href="còpies-de-seguretat.html#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="còpies-de-seguretat.html#cb29-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">NAME</span>        STATE     READ WRITE CKSUM</span>
<span id="cb29-17"><a href="còpies-de-seguretat.html#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">vmZFS</span>       ONLINE       0     0     0</span>
<span id="cb29-18"><a href="còpies-de-seguretat.html#cb29-18" aria-hidden="true" tabindex="-1"></a>          <span class="ex">vdb</span>       ONLINE       0     0     0</span>
<span id="cb29-19"><a href="còpies-de-seguretat.html#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="còpies-de-seguretat.html#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="ex">errors:</span> No known data errors</span>
<span id="cb29-21"><a href="còpies-de-seguretat.html#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="còpies-de-seguretat.html#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="ex">pool:</span> vmZFS1</span>
<span id="cb29-23"><a href="còpies-de-seguretat.html#cb29-23" aria-hidden="true" tabindex="-1"></a> <span class="ex">state:</span> ONLINE</span>
<span id="cb29-24"><a href="còpies-de-seguretat.html#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="ex">config:</span></span>
<span id="cb29-25"><a href="còpies-de-seguretat.html#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="còpies-de-seguretat.html#cb29-26" aria-hidden="true" tabindex="-1"></a>        <span class="ex">NAME</span>        STATE     READ WRITE CKSUM</span>
<span id="cb29-27"><a href="còpies-de-seguretat.html#cb29-27" aria-hidden="true" tabindex="-1"></a>        <span class="ex">vmZFS1</span>      ONLINE       0     0     0</span>
<span id="cb29-28"><a href="còpies-de-seguretat.html#cb29-28" aria-hidden="true" tabindex="-1"></a>          <span class="ex">vde</span>       ONLINE       0     0     0</span>
<span id="cb29-29"><a href="còpies-de-seguretat.html#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="còpies-de-seguretat.html#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="ex">errors:</span> No known data errors</span>
<span id="cb29-31"><a href="còpies-de-seguretat.html#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="còpies-de-seguretat.html#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="ex">pool:</span> zfspool1</span>
<span id="cb29-33"><a href="còpies-de-seguretat.html#cb29-33" aria-hidden="true" tabindex="-1"></a> <span class="ex">state:</span> ONLINE</span>
<span id="cb29-34"><a href="còpies-de-seguretat.html#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="ex">config:</span></span>
<span id="cb29-35"><a href="còpies-de-seguretat.html#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="còpies-de-seguretat.html#cb29-36" aria-hidden="true" tabindex="-1"></a>        <span class="ex">NAME</span>        STATE     READ WRITE CKSUM</span>
<span id="cb29-37"><a href="còpies-de-seguretat.html#cb29-37" aria-hidden="true" tabindex="-1"></a>        <span class="ex">zfspool1</span>    ONLINE       0     0     0</span>
<span id="cb29-38"><a href="còpies-de-seguretat.html#cb29-38" aria-hidden="true" tabindex="-1"></a>          <span class="ex">vdc</span>       ONLINE       0     0     0</span>
<span id="cb29-39"><a href="còpies-de-seguretat.html#cb29-39" aria-hidden="true" tabindex="-1"></a>          <span class="ex">vdd</span>       ONLINE       0     0     0</span>
<span id="cb29-40"><a href="còpies-de-seguretat.html#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="còpies-de-seguretat.html#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="ex">errors:</span> No known data errors</span>
<span id="cb29-42"><a href="còpies-de-seguretat.html#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:~#</span> zfs list <span class="at">-r</span> rpool</span>
<span id="cb29-43"><a href="còpies-de-seguretat.html#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="ex">NAME</span>               USED  AVAIL     REFER  MOUNTPOINT</span>
<span id="cb29-44"><a href="còpies-de-seguretat.html#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool</span>             15.2G  22.6G       96K  /rpool</span>
<span id="cb29-45"><a href="còpies-de-seguretat.html#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/ROOT</span>        15.2G  22.6G       96K  /rpool/ROOT</span>
<span id="cb29-46"><a href="còpies-de-seguretat.html#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/ROOT/pve-1</span>  15.2G  22.6G     15.2G  /</span>
<span id="cb29-47"><a href="còpies-de-seguretat.html#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/data</span>         15</span></code></pre></div>
<p>El sistema base Debian de proxmox està en rpool, i l’arrel en rpool/ROOT/pve-1.
Per poder clonar, primer hem de fer un snapshot i després clonar d’aques snap segons la documentacio <a href="https://www.howtoforge.com/tutorial/how-to-use-snapshots-clones-and-replication-in-zfs-on-linux/">clones ZFS</a></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="còpies-de-seguretat.html#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="còpies-de-seguretat.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/rpool#</span> df</span>
<span id="cb30-3"><a href="còpies-de-seguretat.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Filesystem</span>                         1K-blocks     Used Available Use% Mounted on</span>
<span id="cb30-4"><a href="còpies-de-seguretat.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">udev</span>                                14001688        0  14001688   0% /dev</span>
<span id="cb30-5"><a href="còpies-de-seguretat.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">tmpfs</span>                                2807172     1304   2805868   1% /run</span>
<span id="cb30-6"><a href="còpies-de-seguretat.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/ROOT/pve-1</span>                    39619072 15897344  23721728  41% /</span>
<span id="cb30-7"><a href="còpies-de-seguretat.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="ex">tmpfs</span>                               14035840    43680  13992160   1% /dev/shm</span>
<span id="cb30-8"><a href="còpies-de-seguretat.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">tmpfs</span>                                   5120        0      5120   0% /run/lock</span>
<span id="cb30-9"><a href="còpies-de-seguretat.html#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="ex">vmZFS</span>                               68554496      128  68554368   1% /vmZFS</span>
<span id="cb30-10"><a href="còpies-de-seguretat.html#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool</span>                               23721856      128  23721728   1% /rpool</span>
<span id="cb30-11"><a href="còpies-de-seguretat.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/data</span>                          23721856      128  23721728   1% /rpool/data</span>
<span id="cb30-12"><a href="còpies-de-seguretat.html#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/ROOT</span>                          23721856      128  23721728   1% /rpool/ROOT</span>
<span id="cb30-13"><a href="còpies-de-seguretat.html#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="ex">zfspool1</span>                               13056      128     12928   1% /mnt/zfspool1</span>
<span id="cb30-14"><a href="còpies-de-seguretat.html#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/fuse</span>                             131072       20    131052   1% /etc/pve</span>
<span id="cb30-15"><a href="còpies-de-seguretat.html#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="ex">vmZFS1</span>                             101088768      128 101088640   1% /vmZFS1</span>
<span id="cb30-16"><a href="còpies-de-seguretat.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="ex">172.16.0.4:/mnt/datatruenas/backup</span>  55712384  5337856  50374528  10% /mnt/pve/backup</span>
<span id="cb30-17"><a href="còpies-de-seguretat.html#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="ex">vmZFS1/backup</span>                      101088768      128 101088640   1% /vmZFS1/backup</span>
<span id="cb30-18"><a href="còpies-de-seguretat.html#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="ex">tmpfs</span>                                2807168        0   2807168   0% /run/user/0</span>
<span id="cb30-19"><a href="còpies-de-seguretat.html#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/rpool#</span> zfs snapshot rpool/ROOT/pve-1@today</span>
<span id="cb30-20"><a href="còpies-de-seguretat.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/rpool#</span> zfs list <span class="at">-t</span> snapshot</span>
<span id="cb30-21"><a href="còpies-de-seguretat.html#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="ex">NAME</span>                             USED  AVAIL     REFER  MOUNTPOINT</span>
<span id="cb30-22"><a href="còpies-de-seguretat.html#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool@proxmox</span>                      0B      <span class="at">-</span>       96K  <span class="at">-</span></span>
<span id="cb30-23"><a href="còpies-de-seguretat.html#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool@today</span>                        0B      <span class="at">-</span>       96K  <span class="at">-</span></span>
<span id="cb30-24"><a href="còpies-de-seguretat.html#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/ROOT@base_data</span>              64K      <span class="at">-</span>       96K  <span class="at">-</span></span>
<span id="cb30-25"><a href="còpies-de-seguretat.html#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/ROOT/pve-1@today</span>          1.72M      <span class="at">-</span>     15.2G  <span class="at">-</span></span>
<span id="cb30-26"><a href="còpies-de-seguretat.html#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="ex">rpool/data@base_data</span>              56K      <span class="at">-</span>       96K  <span class="at">-</span></span>
<span id="cb30-27"><a href="còpies-de-seguretat.html#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="ex">vmZFS/base-103-disk-0@__base__</span>     8K      <span class="at">-</span>     2.69G  <span class="at">-</span></span>
<span id="cb30-28"><a href="còpies-de-seguretat.html#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="ex">vmZFS/vm-100-disk-0@pfsense</span>      310M      <span class="at">-</span>     1.24G  <span class="at">-</span></span>
<span id="cb30-29"><a href="còpies-de-seguretat.html#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="ex">vmZFS1/backup@today</span>                0B      <span class="at">-</span>       96K  <span class="at">-</span></span>
<span id="cb30-30"><a href="còpies-de-seguretat.html#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/rpool#</span> zfs send rpool/ROOT/pve-1@today <span class="kw">|</span> <span class="ex">zfs</span> receive vmZFS1/backup</span>
<span id="cb30-31"><a href="còpies-de-seguretat.html#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="ex">cannot</span> receive new filesystem stream: destination <span class="st">&#39;vmZFS1/backup&#39;</span> exists</span>
<span id="cb30-32"><a href="còpies-de-seguretat.html#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="ex">must</span> specify <span class="at">-F</span> to overwrite it</span>
<span id="cb30-33"><a href="còpies-de-seguretat.html#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/rpool#</span> zfs send rpool/ROOT/pve-1@today <span class="kw">|</span> <span class="ex">zfs</span> receive vmZFS1/poxmox</span></code></pre></div>
<p>Ens assegurem que tenim els arxius clonats. Anem a on munta el volum /vmZFS1, i veiem que ho ha clonat.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="còpies-de-seguretat.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/#</span> cd vmZFS1/</span>
<span id="cb31-2"><a href="còpies-de-seguretat.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/vmZFS1#</span> ls <span class="at">-l</span></span>
<span id="cb31-3"><a href="còpies-de-seguretat.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ex">total</span> 9</span>
<span id="cb31-4"><a href="còpies-de-seguretat.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxr-xr-x</span>  4 root root  4 May 22 21:07 backup</span>
<span id="cb31-5"><a href="còpies-de-seguretat.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxr-xr-x</span> 21 root root 27 Jun  5 10:10 poxmox</span>
<span id="cb31-6"><a href="còpies-de-seguretat.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/vmZFS1#</span> cd proxmox</span>
<span id="cb31-7"><a href="còpies-de-seguretat.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="ex">-bash:</span> cd: proxmox: No such file or directory</span>
<span id="cb31-8"><a href="còpies-de-seguretat.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/vmZFS1#</span> cd poxmox/</span>
<span id="cb31-9"><a href="còpies-de-seguretat.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/vmZFS1/poxmox#</span> ls</span>
<span id="cb31-10"><a href="còpies-de-seguretat.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="ex">backupZFS</span>  bin  boot  dev  etc  home  lib  lib32</span>
<span id="cb31-11"><a href="còpies-de-seguretat.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="ex">lib64</span>  libx32  media  mnt  opt  proc  root  rpool</span>
<span id="cb31-12"><a href="còpies-de-seguretat.html#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="ex">run</span>  sbin  srv  sys  tmp  usr  var  vmZFS  vmZFS1</span>
<span id="cb31-13"><a href="còpies-de-seguretat.html#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="ex">root@proxmox:/vmZFS1/poxmox#</span> </span></code></pre></div>
<p>En el cas de perdre el sistema base, instalariem una nova còpia de Proxmox i en aquesta carpeta tindriem una còpia de l’original que accederiem simplement muntant el volum, o si tinguerem la copia en un servidor en un altre node, accedint per xarxa.</p>
<div class="rmdtip">
<p>Tratant-se d’una debian, en tindre una còpia de <em>/etc/pve /etc/network/interfaces /etc. /passwd i /etc/resolv.conf</em> seria suficient per restaurar, Pero no ve mal tindre una idea com fer clon de volums, per si es treballa en cluster poder migrar VM entre ells.</p>
</div>
<p>Si s’adopta aquesta solucio per fer la còpia, faltaria fer un script i posar-lo en cron amb un pipe després de send per comprimir la còpia abans d’enviar-la.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="còpies-de-seguretat.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb32-2"><a href="còpies-de-seguretat.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">zfs</span> snapshot rpool/ROOT/pve-1@today</span>
<span id="cb32-3"><a href="còpies-de-seguretat.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="ex">zfs</span> send rpool/ROOT/pve-1@today <span class="kw">|</span> <span class="ex">zfs</span> receive vmZFS1/backupProxmox</span></code></pre></div>
<p>Un altre script per comprimir el /etc i remetre-lo al backup i posar-lo en cron.</p>
<p>Script /etc</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="còpies-de-seguretat.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb33-2"><a href="còpies-de-seguretat.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="va">timestamp</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&#39;%b-%d-%y&#39;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb33-3"><a href="còpies-de-seguretat.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-cvpzf</span> /vmZFS1/etcBackup/etcBackup-<span class="va">${timestamp}</span>.tar.gz /etc</span></code></pre></div>
</div>
<div id="pve-zsync" class="section level3 hasAnchor" number="4.11.3">
<h3><span class="header-section-number">4.11.3</span> pve-zsync<a href="còpies-de-seguretat.html#pve-zsync" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pendent d’estudiar funcionament</p>
<p>Tambe es pot fer el rsync per la GUI de Proxmox, instal·lant <a href="https://pve.proxmox.com/wiki/PVE-zsync">pve-zsync</a></p>
<p>Primer hem d’instal·lar pve-zsync</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="còpies-de-seguretat.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install pve-zsync</span></code></pre></div>
<div id="principals-característiques" class="section level4 hasAnchor" number="4.11.3.1">
<h4><span class="header-section-number">4.11.3.1</span> Principals característiques<a href="còpies-de-seguretat.html#principals-característiques" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Limitador de velocitat</li>
<li>L’interval de sincronització es pot establir mitjançant cron</li>
<li>Sincronització de VM (discs i configuració), però també conjunts de dades ZFS</li>
<li>Pot mantenir diverses còpies de seguretat</li>
<li>Es pot utilitzar en ambdues direccions</li>
<li>Es pot enviar a l’amfitrió local</li>
<li>El trànsit està encriptat</li>
</ul>

</div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="subxarxes-en-proxmox.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="pfsense.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/incitato/prova/edit/main/04-proxmox.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Arts_Escèniques.pdf", "Arts_Escèniques.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
},
"toolbar": {
"position": "static"
}
});
});
</script>

</body>

</html>
